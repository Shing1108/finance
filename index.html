<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é€²éšå€‹äººè²¡å‹™è¿½è¹¤å™¨</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ’°</text></svg>">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
</head>
<body>
    <!-- è¼‰å…¥ä¸­è¦†è“‹å±¤ -->
    <div id="loadingOverlay">
        <div class="spinner"></div>
        <div>è™•ç†ä¸­...</div>
    </div>

<!-- ä¸»æ‡‰ç”¨å®¹å™¨ -->
<div class="app-container">
    <!-- è²¡å‹™å¿«ç…§ - ç§»è‡³å°èˆªæ¬„ä¸Šæ–¹ -->
    <div class="finances-snapshot">
        <div class="snapshot-item blue-item">
            <div class="snapshot-label">ç¸½è³‡ç”¢</div>
            <div class="snapshot-value">
                <span class="currency-symbol">$</span> <span id="topTotalAssets">0.00</span>
            </div>
        </div>
        <div class="snapshot-item red-item">
            <div class="snapshot-label">ä»Šæ—¥æ”¯å‡º</div>
            <div class="snapshot-value">
                <span class="currency-symbol">$</span> <span id="topTodayExpense">0.00</span>
            </div>
        </div>
        <div class="snapshot-item green-item">
            <div class="snapshot-label">ä»Šæ—¥æ”¶å…¥</div>
            <div class="snapshot-value">
                <span class="currency-symbol">$</span> <span id="topTodayIncome">0.00</span>
            </div>
        </div>
    </div>

    <!-- é ‚éƒ¨å°èˆªæ¬„ - ç§»è‡³è²¡å‹™å¿«ç…§ä¸‹æ–¹ -->
    <nav class="top-navigation">
        <ul class="nav-tabs">
            <li data-tab="dashboard" class="active">
                <i class="fas fa-home"></i> å„€è¡¨æ¿
            </li>
            <li data-tab="accounts">
                <i class="fas fa-wallet"></i> æˆ¶å£
            </li>
            <li data-tab="transactions">
                <i class="fas fa-exchange-alt"></i> è¨˜è³¬
            </li>
            <li data-tab="budgets">
                <i class="fas fa-chart-pie"></i> é ç®—
            </li>
            <li data-tab="categories">
                <i class="fas fa-tags"></i> é¡åˆ¥
            </li>
            <li data-tab="statistics">
                <i class="fas fa-chart-line"></i> çµ±è¨ˆ
            </li>
            <li data-tab="savingsGoals">
                <i class="fas fa-piggy-bank"></i> ç›®æ¨™
            </li>
            <li data-tab="dataAnalytics">
                <i class="fas fa-chart-bar"></i> åˆ†æ
            </li>
            <li data-tab="sync">
                <i class="fas fa-cloud"></i> åŒæ­¥
            </li>
        </ul>
    </nav>

        <!-- ä¸»å…§å®¹å€åŸŸ -->
        <main class="main-content">
            <!-- å„€è¡¨æ¿ -->
            <div id="dashboard" class="tab-content active">
                <h2>å„€è¡¨æ¿</h2>
                <div class="dashboard-widgets">
                    <!-- ä»Šæ—¥äº¤æ˜“å¡ç‰‡ -->
                    <div class="card">
                        <div class="card-header">
                            <h3>ğŸ“… ä»Šæ—¥äº¤æ˜“</h3>
                        </div>
                        <div id="todayTransactionsList" class="transactions-list">
                            <p class="empty-message">ä»Šæ—¥å°šç„¡äº¤æ˜“è¨˜éŒ„</p>
                        </div>
                    </div>

                    <!-- é ç®—ç‹€æ…‹å¡ç‰‡ -->
                    <div class="card">
                        <div class="card-header">
                            <h3>ğŸ“Š é ç®—ç‹€æ…‹</h3>
                        </div>
                        <div id="budgetStatus" class="budget-status">
                            <p class="empty-message">å°šæœªè¨­å®šé ç®—</p>
                            <a href="#" onclick="showTabContent('budgets')" class="action-link">è¨­å®šé ç®—</a>
                        </div>
                    </div>

                    <!-- è¿‘æœŸäº¤æ˜“å¡ç‰‡ -->
                    <div class="card">
                        <div class="card-header">
                            <h3>ğŸ•’ è¿‘æœŸäº¤æ˜“</h3>
                            <a href="#" onclick="showTabContent('transactions')" class="view-all">æŸ¥çœ‹å…¨éƒ¨äº¤æ˜“</a>
                        </div>
                        <div id="recentTransactionsList" class="transactions-list">
                            <p class="empty-message">å°šç„¡äº¤æ˜“è¨˜éŒ„</p>
                        </div>
                    </div>

                    <!-- è²¡å‹™å¥åº·å¡ç‰‡ -->
                    <div class="card">
                        <div class="card-header">
                            <h3>ğŸ’¡ è²¡å‹™å¥åº·æŒ‡æ•¸</h3>
                        </div>
                        <div class="financial-health">
                            <div class="health-score">
                                <div id="financialHealthIndex">--</div>
                                <div class="status">è¨ˆç®—ä¸­...</div>
                            </div>
                            <div class="health-advice">
                                <h4>å€‹äººåŒ–è²¡å‹™å»ºè­°</h4>
                                <p id="financialAdvice">è¼‰å…¥ä¸­...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æˆ¶å£ç®¡ç† -->
            <div id="accounts" class="tab-content">
                <h2>æˆ¶å£ç®¡ç†</h2>
                <div class="card-actions">
                    <button id="addAccountButton" class="btn btn-primary">
                        <i class="fas fa-plus"></i>æ–°å¢æˆ¶å£
                    </button>
                </div>
                <div class="section-header">
                    <h3>æˆ‘çš„æˆ¶å£</h3>
                    <div class="view-toggle">
                        <button id="accountCardView" class="btn btn-sm active">å¡ç‰‡è¦–åœ–</button>
                        <button id="accountListView" class="btn btn-sm">åˆ—è¡¨è¦–åœ–</button>
                    </div>
                </div>
                <div id="accountsList" class="accounts-list card-view">
                    <p class="empty-message">å°šæœªè¨­ç½®ä»»ä½•æˆ¶å£</p>
                </div>

                <!-- è½‰è³¬å€å¡Š -->
                <div class="card">
                    <div class="card-header">
                        <h3>ğŸ”„ è½‰è³¬</h3>
                    </div>
                    <div class="transfer-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="fromAccount">å¾æˆ¶å£</label>
                                <select id="fromAccount" class="form-control">
                                    <option value="" disabled selected>é¸æ“‡æˆ¶å£</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="toAccount">è‡³æˆ¶å£</label>
                                <select id="toAccount" class="form-control">
                                    <option value="" disabled selected>é¸æ“‡æˆ¶å£</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="transferAmount">é‡‘é¡</label>
                                <input type="number" id="transferAmount" class="form-control" min="0" step="0.01">
                            </div>
                        </div>
                        <div class="exchange_special exchange-rate-info">
                            <div>åŒ¯ç‡: <span id="transferExchangeRate">--</span></div>
                            <div>æ”¶æ¬¾é‡‘é¡: <span id="receivingAmount">--</span></div>
                        </div>
                        <button id="confirmTransferButton" class="btn btn-primary">ç¢ºèªè½‰è³¬</button>
                    </div>
                </div>
            </div>

            <!-- è¨˜è³¬å€åŸŸ -->
            <div id="transactions" class="tab-content">
                <h2>ğŸ“ è¨˜éŒ„æ”¶å…¥/æ”¯å‡º</h2>
                <div class="transactions-tabs">
                    <div class="tab-buttons">
                        <button id="incomeTabButton" class="tab-button active">ğŸ’¹ æ”¶å…¥</button>
                        <button id="expenseTabButton" class="tab-button">ğŸ’¸ æ”¯å‡º</button>
                    </div>
                    <div id="incomeTab" class="transaction-tab-content active">
                        <div class="transaction-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="incomeAccount">é¸æ“‡æˆ¶å£</label>
                                    <select id="incomeAccount" class="form-control">
                                        <option value="" disabled selected>é¸æ“‡æˆ¶å£</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="incomeCategory">é¸æ“‡é¡åˆ¥</label>
                                    <select id="incomeCategory" class="form-control">
                                        <option value="" disabled selected>é¸æ“‡é¡åˆ¥</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="incomeAmount">é‡‘é¡</label>
                                    <input type="number" id="incomeAmount" class="form-control" min="0" step="0.01">
                                </div>
                                <div class="form-group">
                                    <label for="incomeCurrency">è²¨å¹£</label>
                                    <select id="incomeCurrency" class="form-control">
                                        <option value="HKD">æ¸¯å¹£ (HKD)</option>
                                        <option value="USD">ç¾å…ƒ (USD)</option>
                                        <option value="CNY">äººæ°‘å¹£ (CNY)</option>
                                        <option value="EUR">æ­å…ƒ (EUR)</option>
                                        <option value="GBP">è‹±éŠ (GBP)</option>
                                        <option value="JPY">æ—¥åœ“ (JPY)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="incomeDate">æ—¥æœŸ</label>
                                    <input type="date" id="incomeDate" class="form-control">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group full-width">
                                    <label for="incomeNote">å‚™è¨» (å¯é¸)</label>
                                    <input type="text" id="incomeNote" class="form-control">
                                </div>
                            </div>
                            <button id="saveIncomeButton" class="btn btn-primary">ä¿å­˜</button>
                        </div>
                    </div>
                    <div id="expenseTab" class="transaction-tab-content">
                        <div class="transaction-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="expenseAccount">é¸æ“‡æˆ¶å£</label>
                                    <select id="expenseAccount" class="form-control">
                                        <option value="" disabled selected>é¸æ“‡æˆ¶å£</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="expenseCategory">é¸æ“‡é¡åˆ¥</label>
                                    <select id="expenseCategory" class="form-control">
                                        <option value="" disabled selected>é¸æ“‡é¡åˆ¥</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="expenseAmount">é‡‘é¡</label>
                                    <input type="number" id="expenseAmount" class="form-control" min="0" step="0.01">
                                </div>
                                <div class="form-group">
                                    <label for="expenseCurrency">è²¨å¹£</label>
                                    <select id="expenseCurrency" class="form-control">
                                        <option value="HKD">æ¸¯å¹£ (HKD)</option>
                                        <option value="USD">ç¾å…ƒ (USD)</option>
                                        <option value="CNY">äººæ°‘å¹£ (CNY)</option>
                                        <option value="EUR">æ­å…ƒ (EUR)</option>
                                        <option value="GBP">è‹±éŠ (GBP)</option>
                                        <option value="JPY">æ—¥åœ“ (JPY)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="expenseDate">æ—¥æœŸ</label>
                                    <input type="date" id="expenseDate" class="form-control">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group full-width">
                                    <label for="expenseNote">å‚™è¨» (å¯é¸)</label>
                                    <input type="text" id="expenseNote" class="form-control">
                                </div>
                            </div>
                            <button id="saveExpenseButton" class="btn btn-primary">ä¿å­˜</button>
                        </div>
                    </div>
                </div>

                <!-- äº¤æ˜“è¨˜éŒ„ -->
                <div class="card mt-2">
                    <div class="card-header">
                        <h3>ğŸ“‹ äº¤æ˜“è¨˜éŒ„</h3>
                    </div>
                    <div class="transaction-filters">
                        <div class="filter-group">
                            <label>æ—¥æœŸç¯„åœ</label>
                            <div class="date-range">
                                <input type="date" id="startDate" class="form-control">
                                <span>è‡³</span>
                                <input type="date" id="endDate" class="form-control">
                            </div>
                        </div>
                        <div class="filter-group">
                            <label>é¡å‹</label>
                            <select id="transactionTypeFilter" class="form-control">
                                <option value="all">å…¨éƒ¨</option>
                                <option value="income">æ”¶å…¥</option>
                                <option value="expense">æ”¯å‡º</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>é¡åˆ¥</label>
                            <select id="categoryFilter" class="form-control">
                                <option value="all">å…¨éƒ¨é¡åˆ¥</option>
                            </select>
                        </div>
                        <button id="searchTransactionsButton" class="btn btn-primary">æœå°‹</button>
                    </div>
                    <div id="transactionsList" class="transactions-list">
                        <p class="empty-message">ç„¡ç¬¦åˆæ¢ä»¶çš„äº¤æ˜“è¨˜éŒ„</p>
                    </div>
                </div>
            </div>

            <!-- é ç®—è¨­å®š -->
            <div id="budgets" class="tab-content">
                <h2>é ç®—è¨­å®š</h2>
                <!-- å…§å®¹å°‡ç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
            </div>

            <!-- é¡åˆ¥ç®¡ç† -->
            <div id="categories" class="tab-content">
                <h2>ğŸ·ï¸ é¡åˆ¥ç®¡ç†</h2>
                <div class="category-tabs">
                    <div class="tab-buttons">
                        <button id="incomeCategoryTabButton" class="tab-button active">ğŸ’¹ æ”¶å…¥é¡åˆ¥</button>
                        <button id="expenseCategoryTabButton" class="tab-button">ğŸ’¸ æ”¯å‡ºé¡åˆ¥</button>
                    </div>
                    <div id="incomeCategoryTab" class="category-tab-content active">
                        <div class="view-toggle">
                            <button id="incomeCategoryCardView" class="btn btn-sm active">å¡ç‰‡è¦–åœ–</button>
                            <button id="incomeCategoryListView" class="btn btn-sm">åˆ—è¡¨è¦–åœ–</button>
                        </div>
                        <div id="incomeCategoriesList" class="categories-list card-view">
                            <div class="category-add-card">
                                <button id="addIncomeCategoryButton" class="btn btn-add">+ æ–°å¢</button>
                            </div>
                            <p class="empty-message">å°šæœªè¨­ç½®æ”¶å…¥é¡åˆ¥</p>
                        </div>
                    </div>
                    <div id="expenseCategoryTab" class="category-tab-content">
                        <div class="view-toggle">
                            <button id="expenseCategoryCardView" class="btn btn-sm active">å¡ç‰‡è¦–åœ–</button>
                            <button id="expenseCategoryListView" class="btn btn-sm">åˆ—è¡¨è¦–åœ–</button>
                        </div>
                        <div id="expenseCategoriesList" class="categories-list card-view">
                            <div class="category-add-card">
                                <button id="addExpenseCategoryButton" class="btn btn-add">+ æ–°å¢</button>
                            </div>
                            <p class="empty-message">å°šæœªè¨­ç½®æ”¯å‡ºé¡åˆ¥</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- çµ±è¨ˆåˆ†æ -->
            <div id="statistics" class="tab-content">
                <h2>ğŸ“ˆ æ¯æœˆæ”¶æ”¯çµ±è¨ˆ</h2>
                <div class="statistics-container">
                    <div class="card">
                        <div class="card-header">
                            <h3>æ”¶å…¥åˆ†ä½ˆ</h3>
                        </div>
                        <div id="incomeChart" class="chart-container">
                            <div class="chart-loading">
                                <div class="spinner"></div>
                                <p>è¼‰å…¥ä¸­...</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3>æ”¯å‡ºåˆ†ä½ˆ</h3>
                        </div>
                        <div id="expenseChart" class="chart-container">
                            <div class="chart-loading">
                                <div class="spinner"></div>
                                <p>è¼‰å…¥ä¸­...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å„²è“„ç›®æ¨™ -->
            <div id="savingsGoals" class="tab-content">
                <h2>ğŸ’° ç›®æ¨™å„²è“„</h2>
                <div class="card-actions">
                    <button id="addSavingsGoalButton" class="btn btn-primary">
                        <i class="fas fa-plus"></i>æ–°å¢å„²è“„ç›®æ¨™
                    </button>
                </div>
                
                <div id="savingsGoalsList" class="savings-goals-list">
                    <p class="empty-message">å°šæœªè¨­ç½®å„²è“„ç›®æ¨™</p>
                </div>
            </div>

            <!-- æ•¸æ“šåˆ†æ -->
            <div id="dataAnalytics" class="tab-content">
                <h2>ğŸ“Š æ·±åº¦æ•¸æ“šåˆ†æ</h2>

                <!-- åœ–è¡¨å€åŸŸ -->
    <div class="card">
        <div class="card-header">
            <h3>æ”¶æ”¯è¶¨å‹¢</h3>
            <div class="period-selector">
                <button class="btn btn-sm period-btn active" data-period="month">æœ¬æœˆ</button>
                <button class="btn btn-sm period-btn" data-period="quarter">æœ¬å­£</button>
                <button class="btn btn-sm period-btn" data-period="year">æœ¬å¹´</button>
                <button class="btn btn-sm period-btn" data-period="custom">è‡ªå®šç¾©</button>
            </div>
        </div>
        <div class="card-body">
            <div class="custom-period" style="display: none;">
                <div class="form-row">
                    <div class="form-group">
                        <label for="analyticsStartDate">é–‹å§‹æ—¥æœŸ</label>
                        <input type="date" id="analyticsStartDate" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="analyticsEndDate">çµæŸæ—¥æœŸ</label>
                        <input type="date" id="analyticsEndDate" class="form-control">
                    </div>
                    <button id="applyCustomPeriod" class="btn btn-primary">æ‡‰ç”¨</button>
                </div>
            </div>
            <div id="trendChart" class="chart-container"></div>
        </div>
    </div>
    
    <!-- æœˆæ›†æ”¶æ”¯è¦–åœ– -->
    <div class="card">
        <div class="card-header">
            <h3>æœˆæ›†æ”¶æ”¯è¦–åœ–</h3>
            <div class="calendar-controls">
                <button id="prevMonthBtn" class="btn btn-sm"><i class="fas fa-chevron-left"></i></button>
                <span id="currentMonthDisplay">2025å¹´ 4æœˆ</span>
                <button id="nextMonthBtn" class="btn btn-sm"><i class="fas fa-chevron-right"></i></button>
            </div>
        </div>
        <div class="card-body">
            <div id="financeCalendar" class="calendar-container"></div>
        </div>
    </div>
    
    <!-- æ¯æ—¥å¯ç”¨é¤˜é¡ -->
    <div class="card">
        <div class="card-header">
            <h3>æ¯æ—¥å¯ç”¨é¤˜é¡</h3>
        </div>
        <div class="card-body">
            <div id="dailyAvailableBudget">
                <div class="chart-loading">
                    <div class="spinner"></div>
                    <p>è¨ˆç®—ä¸­...</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- æ”¯å‡ºé æ¸¬ -->
    <div class="card">
        <div class="card-header">
            <h3>æ”¯å‡ºé æ¸¬</h3>
        </div>
        <div class="card-body">
            <div class="form-row">
                <div class="form-group">
                    <label for="predictionCategory">é¡åˆ¥</label>
                    <select id="predictionCategory" class="form-control">
                        <option value="all">æ‰€æœ‰é¡åˆ¥</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="predictionPeriod">é æ¸¬æœŸé–“</label>
                    <select id="predictionPeriod" class="form-control">
                        <option value="short">çŸ­æœŸ (30å¤©)</option>
                        <option value="long">é•·æœŸ (1å¹´)</option>
                    </select>
                </div>
                <div class="form-group" style="display: flex; align-items: flex-end;">
                    <button id="generatePredictionBtn" class="btn btn-primary">ç”Ÿæˆé æ¸¬</button>
                </div>
            </div>
            <div id="predictionResults" class="prediction-results">
                <p class="empty-message">é¸æ“‡é¡åˆ¥ä¸¦é»æ“Šã€Œç”Ÿæˆé æ¸¬ã€æŒ‰éˆ•</p>
            </div>
        </div>
    </div>
                
                <div class="analytics-controls">
                    <div class="period-selector">
                        <button class="period-btn active" data-period="month">æœˆ</button>
                        <button class="period-btn" data-period="quarter">å­£</button>
                        <button class="period-btn" data-period="year">å¹´</button>
                        <button class="period-btn" data-period="custom">è‡ªå®šç¾©</button>
                    </div>
                    
                    <div class="custom-period" style="display: none;">
                        <input type="date" id="analyticsStartDate" class="form-control">
                        <span>è‡³</span>
                        <input type="date" id="analyticsEndDate" class="form-control">
                        <button id="applyCustomPeriod" class="btn btn-sm btn-primary">æ‡‰ç”¨</button>
                    </div>
                </div>
                
                <div class="analytics-dashboard">
                    <div class="analytics-card">
                        <h3>æ”¶æ”¯è¶¨å‹¢</h3>
                        <div id="trendChart" class="chart-container">
                            <div class="chart-loading">
                                <div class="spinner"></div>
                                <p>è¼‰å…¥ä¸­...</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="analytics-card">
                        <h3>é¡åˆ¥åˆ†ä½ˆ</h3>
                        <div id="categoryDistribution" class="chart-container">
                            <div class="chart-loading">
                                <div class="spinner"></div>
                                <p>è¼‰å…¥ä¸­...</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="analytics-card">
                        <h3>æ”¶æ”¯å°æ¯”</h3>
                        <div id="comparisonChart" class="chart-container">
                            <div class="chart-loading">
                                <div class="spinner"></div>
                                <p>è¼‰å…¥ä¸­...</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="analytics-card">
                        <h3>è²¡å‹™æ´å¯Ÿ</h3>
                        <div id="financialInsights" class="insights-container">
                            <div class="insight-loading">è¼‰å…¥ä¸­...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- åŒæ­¥ -->
            <div id="sync" class="tab-content">
                <h2>ğŸ”„ æ•¸æ“šåŒæ­¥</h2>
                <div class="card">
                    <div class="card-header">
                        <h3>åŒæ­¥ç‹€æ…‹</h3>
                    </div>
                    <div class="sync-status">
                        <div id="loginStatus">æœªç™»å…¥</div>
                        <div class="sync-actions">
                            <button id="loginButton" class="btn">
                                <i class="fab fa-google"></i> ä½¿ç”¨Googleå¸³æˆ¶ç™»å…¥
                            </button>
                            <button id="logoutButton" class="btn btn-secondary" style="display: none;">ç™»å‡º</button>
                        </div>
                    </div>
                    <div class="sync-info">
                        <div>ä¸Šæ¬¡åŒæ­¥æ™‚é–“: <span id="lastSyncTime">å¾æœªåŒæ­¥</span></div>
                        <div class="sync-controls">
                            <button id="syncNowButton" class="btn btn-primary">ç«‹å³åŒæ­¥</button>
                            <div class="checkbox-group">
                                <input type="checkbox" id="autoSync" class="form-checkbox">
                                <label for="autoSync">å•Ÿç”¨è‡ªå‹•åŒæ­¥ (æ¯æ¬¡æ•¸æ“šè®Šæ›´æ™‚)</label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>ğŸ’¾ æ•¸æ“šå‚™ä»½èˆ‡é‚„åŸ</h3>
                    </div>
                    <div class="backup-restore">
                        <div class="backup-section">
                            <h4>åŒ¯å‡ºæ•¸æ“š</h4>
                            <button id="exportDataButton" class="btn btn-secondary">ä¸‹è¼‰ç‚ºæ–‡ä»¶</button>
                        </div>
                        
                        <div class="restore-section">
                            <h4>åŒ¯å…¥æ•¸æ“š</h4>
                            <div class="import-options">
                                <div class="file-upload">
                                    <label for="fileImport" class="btn btn-secondary">å¾æ–‡ä»¶ä¸Šå‚³</label>
                                    <input type="file" id="fileImport" accept=".json" style="display: none;">
                                </div>
                                <div class="or-divider">æˆ–</div>
                                <div class="text-import">
                                    <textarea id="jsonImport" placeholder="è²¼ä¸Šä¹‹å‰åŒ¯å‡ºçš„æ•¸æ“š:"></textarea>
                                    <button id="importDataButton" class="btn btn-primary">åŒ¯å…¥æ•¸æ“š</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- æ¨¡æ…‹æ¡† -->
    <!-- æ–°å¢æˆ¶å£æ¨¡æ…‹æ¡† -->
    <div id="addAccountModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>æ–°å¢æˆ¶å£</h3>
                <span class="close-button">&times;</span>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editAccountId" value="">
                <div class="form-group">
                    <label for="accountName">æˆ¶å£åç¨±</label>
                    <input type="text" id="accountName" class="form-control">
                </div>
                <div class="form-group">
                    <label for="accountType">æˆ¶å£é¡å‹</label>
                    <select id="accountType" class="form-control">
                        <option value="" disabled selected>é¸æ“‡é¡å‹</option>
                        <option value="cash">ç¾é‡‘</option>
                        <option value="bank">éŠ€è¡Œæˆ¶å£</option>
                        <option value="credit">ä¿¡ç”¨å¡</option>
                        <option value="investment">æŠ•è³‡</option>
                        <option value="other">å…¶ä»–</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="initialBalance">åˆå§‹é¤˜é¡</label>
                    <input type="number" id="initialBalance" class="form-control" min="0" step="0.01">
                </div>
                <div class="form-group">
                    <label for="accountCurrency">è²¨å¹£</label>
                    <select id="accountCurrency" class="form-control">
                        <option value="HKD">æ¸¯å¹£ (HKD)</option>
                        <option value="USD">ç¾å…ƒ (USD)</option>
                        <option value="CNY">äººæ°‘å¹£ (CNY)</option>
                        <option value="EUR">æ­å…ƒ (EUR)</option>
                        <option value="GBP">è‹±éŠ (GBP)</option>
                        <option value="JPY">æ—¥å…ƒ (JPY)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="accountNote">å‚™è¨» (å¯é¸)</label>
                    <textarea id="accountNote" class="form-control"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button id="saveAccountButton" class="btn btn-primary">ä¿å­˜</button>
                <button class="btn btn-secondary modal-cancel">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <!-- æ–°å¢é¡åˆ¥æ¨¡æ…‹æ¡† -->
    <div id="addCategoryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>æ–°å¢é¡åˆ¥</h3>
                <span class="close-button">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="categoryName">é¡åˆ¥åç¨±</label>
                    <input type="text" id="categoryName" class="form-control">
                </div>
                <div class="form-group">
                    <label for="categoryIcon">åœ–æ¨™</label>
                    <div class="icon-selector">
                        <div class="icon-preview">
                            <i id="selectedIcon" class="fas fa-tag"></i>
                        </div>
                        <button id="selectIconButton" class="btn btn-secondary">é¸æ“‡åœ–æ¨™</button>
                        <div id="iconGrid" class="icon-grid" style="display: none;">
                            <!-- åœ–æ¨™ç¶²æ ¼ç”±JavaScriptå‹•æ…‹ç”Ÿæˆ -->
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="categoryColor">é¡è‰²</label>
                    <input type="color" id="categoryColor" class="form-control color-picker" value="#4CAF50">
                </div>
                <div class="form-group">
                    <label for="categoryOrder">æ’åº (æ•¸å­—è¶Šå°å„ªå…ˆé¡¯ç¤º)</label>
                    <input type="number" id="categoryOrder" class="form-control" min="0" step="1" value="0">
                </div>
                <input type="hidden" id="categoryType" value="income" data-edit-id="">
            </div>
            <div class="modal-footer">
                <button id="saveCategoryButton" class="btn btn-primary">ä¿å­˜</button>
                <button class="btn btn-secondary modal-cancel">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <!-- è¨­å®šæ¨¡æ…‹æ¡† -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>æ‡‰ç”¨è¨­å®š</h3>
                <span class="close-button">&times;</span>
            </div>
            <div class="modal-body">
                <form id="settingsForm">
                    <div class="settings-section">
                        <h4>ç•Œé¢è¨­å®š</h4>
                        <div class="form-group checkbox-group">
                            <input type="checkbox" id="darkMode" class="form-checkbox">
                            <label for="darkMode">æ·±è‰²æ¨¡å¼</label>
                        </div>
                        <div class="form-group">
                            <label>å­—é«”å¤§å°</label>
                            <div class="radio-group">
                                <div class="radio-item">
                                    <input type="radio" id="fontSizeSmall" name="fontSize" value="small">
                                    <label for="fontSizeSmall">å°</label>
                                </div>
                                <div class="radio-item">
                                    <input type="radio" id="fontSizeMedium" name="fontSize" value="medium" checked>
                                    <label for="fontSizeMedium">ä¸­</label>
                                </div>
                                <div class="radio-item">
                                    <input type="radio" id="fontSizeLarge" name="fontSize" value="large">
                                    <label for="fontSizeLarge">å¤§</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group checkbox-group">
                            <input type="checkbox" id="enableFirebaseSync" class="form-checkbox">
                            <label for="enableFirebaseSync">å•Ÿç”¨é›²ç«¯åŒæ­¥ (Firebase)</label>
                        </div>
                    </div>
                    <div class="settings-section">
                        <h4>è²¨å¹£è¨­å®š</h4>
                        <div class="form-group">
                            <label for="defaultCurrency">é è¨­è²¨å¹£</label>
                            <select id="defaultCurrency" class="form-control">
                                <option value="HKD">æ¸¯å¹£ (HKD)</option>
                                <option value="USD">ç¾å…ƒ (USD)</option>
                                <option value="CNY">äººæ°‘å¹£ (CNY)</option>
                                <option value="EUR">æ­å…ƒ (EUR)</option>
                                <option value="GBP">è‹±éŠ (GBP)</option>
                                <option value="JPY">æ—¥å…ƒ (JPY)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>å°æ•¸é»ä½æ•¸</label>
                            <div class="radio-group">
                                <div class="radio-item">
                                    <input type="radio" id="decimalZero" name="decimalPlaces" value="0">
                                    <label for="decimalZero">0</label>
                                </div>
                                <div class="radio-item">
                                    <input type="radio" id="decimalOne" name="decimalPlaces" value="1">
                                    <label for="decimalOne">1</label>
                                </div>
                                <div class="radio-item">
                                    <input type="radio" id="decimalTwo" name="decimalPlaces" value="2" checked>
                                    <label for="decimalTwo">2</label>
                                </div>
                                <div class="radio-item">
                                    <input type="radio" id="decimalThree" name="decimalPlaces" value="3">
                                    <label for="decimalThree">3</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>åŒ¯ç‡è¨­å®š</label>
                            <button id="manageCurrencyButton" type="button" class="btn btn-secondary">åŒ¯ç‡èˆ‡è²¨å¹£ç®¡ç†</button>
                        </div>
                    </div>
                    <div class="settings-section">
                        <h4>é€šçŸ¥è¨­å®š</h4>
                        <div class="form-group checkbox-group">
                            <input type="checkbox" id="enableBudgetAlerts" class="form-checkbox">
                            <label for="enableBudgetAlerts">å•Ÿç”¨é ç®—æé†’</label>
                        </div>
                        <div class="form-group">
                            <label for="alertThreshold">æé†’é–¾å€¼ (%)</label>
                            <input type="number" id="alertThreshold" class="form-control" min="1" max="100" value="80">
                        </div>
                    </div>
                    <div class="settings-section">
                        <h4>æ•¸æ“šç®¡ç†</h4>
                        <button id="clearDataButton" class="btn btn-danger">æ¸…é™¤æ‰€æœ‰æ•¸æ“š</button>
                        <small class="warning-text">è­¦å‘Šï¼šæ­¤æ“ä½œç„¡æ³•å¾©åŸ</small>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button id="saveSettingsButton" class="btn btn-primary">ä¿å­˜è¨­å®š</button>
                <button class="btn btn-secondary modal-cancel">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <!-- é€šçŸ¥æç¤ºToastå®¹å™¨ -->
    <div id="toast-container"></div>

    <!-- æ ¸å¿ƒ JS æ–‡ä»¶è¼‰å…¥ -->
    <!-- å·¥å…·é¡ -->
    <script src="js/utils/utils.js"></script>
    <script src="js/utils/currency.js"></script>
    <script src="js/utils/date-utils.js"></script>
    <script src="js/utils/day-manager.js"></script>

    <!-- æ ¸å¿ƒ -->
    <script src="js/core/models.js"></script>
    <script src="js/core/store.js"></script>
    <script src="js/core/app.js"></script>

    <!-- UI å…ƒä»¶ -->
    <script src="js/ui/ui-core.js"></script>
    <script src="js/ui/ui-accounts.js"></script>
    <script src="js/ui/ui-categories.js"></script>
    <script src="js/ui/ui-transactions.js"></script>
    <script src="js/ui/ui-budget.js"></script>
    <script src="js/ui/ui-dashboard.js"></script>
    <script src="js/ui/ui-charts.js"></script>

    <!-- åŠŸèƒ½æ¨¡å¡Š -->
     <script src="js/features/calendar.js"></script>
    <script src="js/features/sync.js"></script>
    <script src="js/features/savings.js"></script>
    <script src="js/features/analytics.js"></script>
    <script src="js/savings-transaction-listener.js"></script>

    <!-- å¤–éƒ¨ä¾è³´ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- åº•éƒ¨é–“è·ï¼Œé¿å…è¢«å·¥å…·åˆ—é®æ“‹ -->
    <!--<div class="bottom-spacer"></div>-->
    <!-- è¨­å®šå’Œæ—¥æœŸæŒ‰éˆ• -->
    <div class="app-actions">
        <button id="settingsButton" class="snapshot-btn">
            <i class="fas fa-cog"></i>
        </button>
        <button id="startNewDayButton" class="snapshot-btn primary-btn">
            <i class="fas fa-calendar-plus"></i> é–‹å•Ÿæ–°çš„ä¸€å¤©
        </button>
    </div>
    <div class="safe-area-inset-bottom"></div>
    
    <script>
// ç¢ºä¿åœ¨DOMå®Œå…¨è¼‰å…¥å¾Œåˆå§‹åŒ–æ‰€æœ‰UIçµ„ä»¶
document.addEventListener('DOMContentLoaded', function() {
    console.log('é–‹å§‹åˆå§‹åŒ–UIçµ„ä»¶');
    
    // æª¢æŸ¥å¿…è¦çš„UIæ¨¡å¡Šæ˜¯å¦å­˜åœ¨
    if (typeof UiTransactions === 'undefined') {
        console.error('UiTransactionsæœªå®šç¾©');
    } else {
        console.log('åˆå§‹åŒ–UiTransactions');
        UiTransactions.init();
    }
    
    if (typeof UiCategories === 'undefined') {
        console.error('UiCategoriesæœªå®šç¾©');
    } else {
        console.log('åˆå§‹åŒ–UiCategories');
        UiCategories.init();
    }
    
    // å¼·åˆ¶ç¢ºä¿è¡¨å–®é¡¯ç¤ºæ­£ç¢º
    function fixTabDisplay() {
        console.log('ä¿®å¾©è¡¨å–®é¡¯ç¤º');
        
        // äº¤æ˜“è¡¨å–®ä¿®å¾©
        const incomeTabBtn = document.getElementById('incomeTabButton');
        const expenseTabBtn = document.getElementById('expenseTabButton');
        const incomeTab = document.getElementById('incomeTab');
        const expenseTab = document.getElementById('expenseTab');
        
        if (incomeTabBtn && expenseTabBtn && incomeTab && expenseTab) {
            console.log('æ‰¾åˆ°äº¤æ˜“è¡¨å–®å…ƒç´ ï¼Œé‡æ–°ç¶å®šäº‹ä»¶');
            
            // ç¢ºä¿æ”¶å…¥è¡¨å–®é¡¯ç¤º
            if (incomeTabBtn.classList.contains('active')) {
                incomeTab.style.display = 'block';
                expenseTab.style.display = 'none';
            }
            
            // ç¢ºä¿æ”¯å‡ºè¡¨å–®èƒ½å¤ é¡¯ç¤º
            expenseTabBtn.addEventListener('click', function() {
                console.log('é»æ“Šæ”¯å‡ºæŒ‰éˆ•');
                incomeTabBtn.classList.remove('active');
                expenseTabBtn.classList.add('active');
                incomeTab.style.display = 'none';
                expenseTab.style.display = 'block';
            });
        }
        
        // é¡åˆ¥è¡¨å–®ä¿®å¾©
        const incomeCatBtn = document.getElementById('incomeCategoryTabButton');
        const expenseCatBtn = document.getElementById('expenseCategoryTabButton');
        const incomeCatTab = document.getElementById('incomeCategoryTab');
        const expenseCatTab = document.getElementById('expenseCategoryTab');
        
        if (incomeCatBtn && expenseCatBtn && incomeCatTab && expenseCatTab) {
            console.log('æ‰¾åˆ°é¡åˆ¥è¡¨å–®å…ƒç´ ï¼Œé‡æ–°ç¶å®šäº‹ä»¶');
            
            // ç¢ºä¿é¡åˆ¥åˆ‡æ›æ­£ç¢º
            expenseCatBtn.addEventListener('click', function() {
                console.log('é»æ“Šæ”¯å‡ºé¡åˆ¥æŒ‰éˆ•');
                incomeCatBtn.classList.remove('active');
                expenseCatBtn.classList.add('active');
                incomeCatTab.style.display = 'none';
                expenseCatTab.style.display = 'block';
                if (typeof UiCategories !== 'undefined') {
                    UiCategories.currentType = 'expense';
                }
            });
        }
        
        // ä¿®å¾©é¡åˆ¥æ·»åŠ æŒ‰éˆ•
        const addIncomeCatBtn = document.getElementById('addIncomeCategoryButton');
        const addExpenseCatBtn = document.getElementById('addExpenseCategoryButton');
        
        if (addIncomeCatBtn && typeof UiCategories !== 'undefined') {
            console.log('é‡æ–°ç¶å®šæ”¶å…¥é¡åˆ¥æ·»åŠ æŒ‰éˆ•');
            addIncomeCatBtn.addEventListener('click', function() {
                console.log('é»æ“Šæ·»åŠ æ”¶å…¥é¡åˆ¥æŒ‰éˆ•');
                UiCategories.showAddCategoryModal('income');
            });
        }
        
        if (addExpenseCatBtn && typeof UiCategories !== 'undefined') {
            console.log('é‡æ–°ç¶å®šæ”¯å‡ºé¡åˆ¥æ·»åŠ æŒ‰éˆ•');
            addExpenseCatBtn.addEventListener('click', function() {
                console.log('é»æ“Šæ·»åŠ æ”¯å‡ºé¡åˆ¥æŒ‰éˆ•');
                UiCategories.showAddCategoryModal('expense');
            });
        }
    }
    
    // çµ¦DOMä¸€é»æ™‚é–“å®Œå…¨æ¸²æŸ“ï¼Œç„¶å¾Œæ‡‰ç”¨ä¿®å¾©
    setTimeout(fixTabDisplay, 500);
});
</script>
</body>
</html>