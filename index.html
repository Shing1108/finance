<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>進階個人財務追蹤器</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="header">
        <div class="container header-content">
            <div class="logo">
                💰 <span>進階個人財務追蹤器</span>
            </div>
            <div class="user-status">
                <div id="login-status">未登入</div>
                <button id="settings-btn" class="btn">⚙️ 設定</button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="dashboard">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">總資產</div>
                </div>
                <div class="card-body">
                    <h2 id="total-assets">$ 0.00</h2>
                </div>
            </div>
            <div class="card">
                <div class="card-header">
                    <div class="card-title">今日收入</div>
                </div>
                <div class="card-body">
                    <h2 id="today-income" class="positive">$ 0.00</h2>
                </div>
            </div>
            <div class="card">
                <div class="card-header">
                    <div class="card-title">今日支出</div>
                </div>
                <div class="card-body">
                    <h2 id="today-expense" class="negative">$ 0.00</h2>
                </div>
            </div>
        </div>

        <div class="tabs">
            <div class="tab active" data-tab="dashboard">📊 儀表板</div>
            <div class="tab" data-tab="accounts">💳 戶口管理</div>
            <div class="tab" data-tab="transactions">📝 記賬</div>
            <div class="tab" data-tab="budgets">⚙️ 預算設定</div>
            <div class="tab" data-tab="categories">🏷️ 類別管理</div>
            <div class="tab" data-tab="statistics">📈 統計分析</div>
            <div class="tab" data-tab="sync">🔄 同步</div>
        </div>

        <!-- 儀表板 -->
        <div id="dashboard" class="tab-content active">
            <div class="row">
                <div class="col">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">📅 今日交易</div>
                        </div>
                        <div class="card-body">
                            <div id="today-transactions" class="transaction-list">
                                <div class="empty-state">今日尚無交易記錄</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">📊 預算狀態</div>
                        </div>
                        <div class="card-body">
                            <div id="budget-status">
                                <div class="empty-state">尚未設定預算</div>
                                <button id="setup-budget-btn" class="btn btn-primary">設定預算</button>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">🕒 近期交易</div>
                            <a href="#" id="view-all-transactions" class="link">查看全部交易</a>
                        </div>
                        <div class="card-body">
                            <div id="recent-transactions" class="transaction-list">
                                <div class="empty-state">尚無交易記錄</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 戶口管理 -->
        <div id="accounts" class="tab-content">
            <div class="action-bar">
                <button id="add-account-btn" class="btn btn-primary">+ 新增戶口</button>
            </div>
            <div class="card">
                <div class="card-header">
                    <div class="card-title">我的戶口</div>
                </div>
                <div class="card-body">
                    <div id="accounts-list">
                        <div class="empty-state">尚未設置任何戶口</div>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="card-header">
                    <div class="card-title">🔄 轉賬</div>
                </div>
                <div class="card-body">
                    <form id="transfer-form">
                        <div class="form-group">
                            <label for="from-account">從戶口</label>
                            <select id="from-account" required>
                                <option value="">選擇戶口</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="to-account">至戶口</label>
                            <select id="to-account" required>
                                <option value="">選擇戶口</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="transfer-amount">金額</label>
                            <div class="currency-input">
                                <input type="number" id="transfer-amount" min="0" step="0.01" required>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">確認轉賬</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- 記賬 -->
        <div id="transactions" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">📝 記錄收入/支出</div>
                </div>
                <div class="card-body">
                    <div class="tabs transaction-tabs">
                        <div class="tab active" data-tab="income">💹 收入</div>
                        <div class="tab" data-tab="expense">💸 支出</div>
                    </div>
                    <form id="transaction-form">
                        <input type="hidden" id="transaction-type" value="income">
                        <div class="form-group">
                            <label for="transaction-account">選擇戶口</label>
                            <select id="transaction-account" required>
                                <option value="">選擇戶口</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="transaction-category">選擇類別</label>
                            <select id="transaction-category" required>
                                <option value="">選擇類別</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="transaction-amount">金額</label>
                            <div class="currency-input">
                                <input type="number" id="transaction-amount" min="0" step="0.01" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="transaction-date">日期</label>
                            <input type="date" id="transaction-date" required>
                        </div>
                        <div class="form-group">
                            <label for="transaction-notes">備註 (可選)</label>
                            <textarea id="transaction-notes"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">✅ 保存</button>
                    </form>
                </div>
            </div>
            <div class="card">
                <div class="card-header">
                    <div class="card-title">📋 交易記錄</div>
                </div>
                <div class="card-body">
                    <div class="filter-bar">
                        <div class="form-group">
                            <label for="filter-date-from">日期範圍</label>
                            <div class="date-range">
                                <input type="date" id="filter-date-from">
                                <span>至</span>
                                <input type="date" id="filter-date-to">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="filter-type">類型</label>
                            <select id="filter-type">
                                <option value="all">全部</option>
                                <option value="income">收入</option>
                                <option value="expense">支出</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="filter-category">類別</label>
                            <select id="filter-category">
                                <option value="all">全部類別</option>
                            </select>
                        </div>
                        <button id="filter-submit" class="btn btn-primary">🔍 搜尋</button>
                    </div>
                    <div id="transactions-list" class="transaction-list">
                        <div class="empty-state">無符合條件的交易記錄</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 預算設定 -->
        <div id="budgets" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">⚙️ 總預算設定</div>
                </div>
                <div class="card-body">
                    <form id="main-budget-form">
                        <div class="form-group">
                            <label for="budget-amount">預算金額</label>
                            <div class="currency-input">
                                <input type="number" id="budget-amount" min="0" step="0.01" required>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="auto-calculate">
                                <label for="auto-calculate">自動計算 (類別預算總和)</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>重設週期</label>
                            <div class="radio-group">
                                <div class="radio-item">
                                    <input type="radio" id="cycle-daily" name="budget-cycle" value="daily">
                                    <label for="cycle-daily">每日</label>
                                </div>
                                <div class="radio-item">
                                    <input type="radio" id="cycle-weekly" name="budget-cycle" value="weekly">
                                    <label for="cycle-weekly">每週</label>
                                </div>
                                <div class="radio-item">
                                    <input type="radio" id="cycle-monthly" name="budget-cycle" value="monthly" checked>
                                    <label for="cycle-monthly">每月</label>
                                </div>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">✅ 保存設定</button>
                    </form>
                </div>
            </div>
            <div class="card">
                <div class="card-header">
                    <div class="card-title">📊 類別預算設定</div>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label for="budget-category">選擇類別</label>
                        <div class="input-with-button">
                            <select id="budget-category">
                                <option value="">選擇類別</option>
                            </select>
                            <button id="add-category-budget" class="btn">添加</button>
                        </div>
                    </div>
                    <div id="category-budgets">
                        <div class="empty-state">尚未設置類別預算</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 類別管理 -->
        <div id="categories" class="tab-content">
            <div class="tabs category-tabs">
                <div class="tab active" data-tab="income-categories">💹 收入類別</div>
                <div class="tab" data-tab="expense-categories">💸 支出類別</div>
            </div>
            <div class="action-bar">
                <button id="add-category-btn" class="btn btn-primary">+ 新增</button>
            </div>
            <div id="income-categories" class="category-content active">
                <div id="income-categories-list" class="categories-list">
                    <div class="empty-state">尚未設置收入類別</div>
                </div>
            </div>
            <div id="expense-categories" class="category-content">
                <div id="expense-categories-list" class="categories-list">
                    <div class="empty-state">尚未設置支出類別</div>
                </div>
            </div>
        </div>

        <!-- 統計分析 -->
        <div id="statistics" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">📈 每月收支統計</div>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="monthly-chart"></canvas>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">收入分佈</div>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="income-pie-chart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">支出分佈</div>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="expense-pie-chart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 同步頁面 -->
        <div id="sync" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">🔄 數據同步</div>
                </div>
                <div class="card-body">
                    <div class="sync-status">
                        <div id="firebase-login-status" class="status-box">
                            <h3>同步狀態</h3>
                            <p id="sync-status-message">未登入</p>
                        </div>
                        <div class="login-buttons">
                            <button id="firebase-login-btn" class="btn btn-primary">使用Google帳戶登入</button>
                            <button id="firebase-logout-btn" class="btn btn-danger" style="display:none">登出</button>
                        </div>
                    </div>
                    <div class="last-sync-info">
                        <p>上次同步時間: <span id="last-sync-time">從未同步</span></p>
                    </div>
                    <div class="sync-controls">
                        <button id="manual-sync" class="btn btn-primary" disabled>立即同步</button>
                        <div class="form-group">
                            <div class="checkbox-group">
                                <input type="checkbox" id="auto-sync" disabled>
                                <label for="auto-sync">啟用自動同步 (每次數據變更時)</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="card-header">
                    <div class="card-title">💾 數據備份與還原</div>
                </div>
                <div class="card-body">
                    <div class="backup-controls">
                        <button id="export-data" class="btn">匯出數據</button>
                        <button id="download-data" class="btn">下載為文件</button>
                    </div>
                    <div class="restore-controls">
                        <div class="form-group">
                            <label for="import-file">從文件上傳</label>
                            <input type="file" id="import-file" accept=".json">
                        </div>
                        <div class="form-group">
                            <label for="import-text">或貼上之前匯出的數據:</label>
                            <textarea id="import-text" rows="5"></textarea>
                        </div>
                        <button id="import-data" class="btn btn-warning">匯入數據</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 模態框 -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div id="modal-content"></div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        // Import the functions you need from the SDKs
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
        import { getDatabase } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-database.js";
        import { getAuth } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-auth.js";

        // 您需要從Firebase控制台獲取這些配置信息
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT.firebaseapp.com",
            databaseURL: "https://YOUR_PROJECT.firebaseio.com",
            projectId: "YOUR_PROJECT",
            storageBucket: "YOUR_PROJECT.appspot.com",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // 初始化Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);
        
        // 將Firebase物件設為全域，以便在script.js中使用
        window.firebaseApp = app;
        window.firebaseDb = db;
        window.firebaseAuth = auth;
    </script>
    
    <!-- 引入 Chart.js 用於數據可視化 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- 自訂腳本 -->
    <script src="script.js"></script>
</body>
</html>
